<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tapnow Studio - AI短剧工作流</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Tone.js for UI sounds -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <style>
        /* macOS System Fonts */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #f5f5f7;
            overflow: hidden;
            user-select: none;
        }

        /* macOS Translucency Effects */
        .glass {
            background: rgba(255, 255, 255, 0.72);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 0.5px solid rgba(0, 0, 0, 0.08);
        }

        .glass-dark {
            background: rgba(30, 30, 30, 0.82);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 0.5px solid rgba(255, 255, 255, 0.08);
        }

        /* Dot Grid Background */
        .dot-grid {
            background-image: radial-gradient(rgba(0,0,0,0.08) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .dark .dot-grid {
            background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
        }

        /* Custom Scrollbar macOS Style */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.15);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.25);
        }

        /* Node Animations */
        @keyframes nodePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 0 0 4px rgba(59, 130, 246, 0); }
        }
        .node-processing {
            animation: nodePulse 2s infinite;
        }

        /* Traffic Lights */
        .traffic-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            box-shadow: inset 0 0 0 0.5px rgba(0,0,0,0.1);
        }
        .tl-close { background: #ff5f56; }
        .tl-min { background: #ffbd2e; }
        .tl-max { background: #27c93f; }

        /* Connection Lines */
        .connection-line {
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
            stroke-linecap: round;
            transition: all 0.3s;
        }
        .connection-line:hover {
            stroke: #2563eb;
            stroke-width: 3;
        }

        /* Text Selection */
        .selectable {
            user-select: text;
        }

        /* Range Slider macOS Style */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 0 0 0.5px rgba(0,0,0,0.1);
            margin-top: -6px;
            cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
        }

        /* Syntax Highlighting模拟 */
        .code-block {
            font-family: "SF Mono", Monaco, monospace;
            font-size: 12px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // Icon Components using Lucide
        const Icon = ({ name, size = 16, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current) {
                    iconRef.current.innerHTML = '';
                    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute("viewBox", "0 0 24 24");
                    svg.setAttribute("width", size);
                    svg.setAttribute("height", size);
                    svg.setAttribute("fill", "none");
                    svg.setAttribute("stroke", "currentColor");
                    svg.setAttribute("stroke-width", "2");
                    svg.setAttribute("stroke-linecap", "round");
                    svg.setAttribute("stroke-linejoin", "round");
                    svg.className = className;
                    
                    // Simple path mapping for common icons
                    const paths = {
                        'plus': 'M12 5v14M5 12h14',
                        'minus': 'M5 12h14',
                        'x': 'M18 6 6 18M6 6l12 12',
                        'play': 'm5 3 14 9-14 9V3z',
                        'pause': 'M10 3H6v18h4V3zm8 0h-4v18h4V3z',
                        'settings': 'M12.22 2h-.44a2 2 0 0 0-2 1.31l-.5 1.5a2 2 0 0 1-2.4 1.18l-1.5-.4a2 2 0 0 0-2.4 1.2l-.2.43a2 2 0 0 0 .8 2.46l1.3.9a2 2 0 0 1 0 3.32l-1.3.9a2 2 0 0 0-.8 2.46l.2.43a2 2 0 0 0 2.4 1.2l1.5-.4a2 2 0 0 1 2.4 1.18l.5 1.5a2 2 0 0 0 2 1.31h.44a2 2 0 0 0 2-1.31l.5-1.5a2 2 0 0 1 2.4-1.18l1.5.4a2 2 0 0 0 2.4-1.2l.2-.43a2 2 0 0 0-.8-2.46l-1.3-.9a2 2 0 0 1 0-3.32l1.3-.9a2 2 0 0 0 .8-2.46l-.2-.43a2 2 0 0 0-2.4-1.2l-1.5.4a2 2 0 0 1-2.4-1.18l-.5-1.5a2 2 0 0 0-2-1.31zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z',
                        'film': 'M7 2v11h3v9l7-12h-4l4-8z',
                        'image': 'M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z',
                        'video': 'm22 8-6 4 6 4V8zM2 7h14a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z',
                        'music': 'M9 18V5l12-2v13M9 18a3 3 0 1 1-6 0 3 3 0 0 1 6 0zm12-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0z',
                        'mic': 'M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3zm-7 8v2a7 7 0 0 0 14 0v-2m-7 8v4m-4 0h8',
                        'type': 'M4 7V4h16v3M9 20h6M12 4v16',
                        'wand': 'M15 4V2m0 14v-2M8 9h2m10 0h2M7 7l2 2m8 8 2 2M4 15l-1 4 4-1 9-9z',
                        'cpu': 'M4 4h16v16H4zM9 9h6v6H9zM9 1v3m6-3v3M9 20v3m6-3v3m8-9h-3m3-6h-3M4 12H1m3-6H1m20 6h-3',
                        'share': 'M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8m-4-6-4-4-4 4m4-4v13',
                        'download': 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4m4-5 5 5 5-5M12 15V3',
                        'save': 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8',
                        'trash': 'M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2',
                        'copy': 'M8 4v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7.242a2 2 0 0 0-.602-1.43L16.083 2.57A2 2 0 0 0 14.659 2H10a2 2 0 0 0-2 2zM16 18v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2',
                        'more-horizontal': 'M5 12h.01M12 12h.01M19 12h.01',
                        'layout': 'M3 3h7v7H3zm0 11h7v7H3zm11-11h7v7h-7zm0 11h7v7h-7z',
                        'git-branch': 'M6 3v12m12-6a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm-6 3H6m0 0a3 3 0 1 0 6 0 3 3 0 0 0-6 0z',
                        'zap': 'M13 2L3 14h9l-1 8 10-12h-9l1-8z',
                        'eye': 'M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z',
                        'refresh': 'M23 4v6h-6M1 20v-6h6m16-4a10 10 0 0 0-19.53-2.47M1 16a10 10 0 0 0 19.53 2.47',
                        'check': 'M20 6 9 17l-5-5',
                        'alert': 'M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4m0 4h.01'
                    };
                    
                    if (paths[name]) {
                        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                        path.setAttribute("d", paths[name]);
                        svg.appendChild(path);
                    }
                    iconRef.current.appendChild(svg);
                }
            }, [name, size, className]);
            
            return <span ref={iconRef} className="inline-flex items-center justify-center" />;
        };

        // 节点类型定义
        const NODE_TYPES = {
            SCRIPT_INPUT: { 
                id: 'script', label: '剧本输入', icon: 'type', color: 'bg-blue-500', 
                inputs: [], outputs: ['script'],
                config: { placeholder: '输入短剧剧本内容...', rows: 6 }
            },
            STORYBOARD: { 
                id: 'storyboard', label: '智能分镜', icon: 'layout', color: 'bg-purple-500',
                inputs: ['script'], outputs: ['frames'],
                config: { scenes: 5, style: '电影感' }
            },
            CHARACTER: { 
                id: 'character', label: '角色设计', icon: 'cpu', color: 'bg-pink-500',
                inputs: ['frames'], outputs: ['characters'],
                config: { consistency: true, style: '写实/动漫' }
            },
            TEXT2IMAGE: { 
                id: 't2i', label: '文生图', icon: 'image', color: 'bg-green-500',
                inputs: ['prompt'], outputs: ['image'],
                config: { model: 'midjourney-v6', size: '16:9' }
            },
            IMAGE2VIDEO: { 
                id: 'i2v', label: '图生视频', icon: 'video', color: 'bg-orange-500',
                inputs: ['image'], outputs: ['video'],
                config: { duration: 4, motion: 'medium' }
            },
            VIDEO_PROMPT: { 
                id: 'vid_prompt', label: '视频生成', icon: 'film', color: 'bg-red-500',
                inputs: ['prompt', 'image'], outputs: ['video'],
                config: { model: 'kling-1.5', quality: 'high' }
            },
            VOICEOVER: { 
                id: 'voice', label: 'AI配音', icon: 'mic', color: 'bg-indigo-500',
                inputs: ['script'], outputs: ['audio'],
                config: { voice: 'zh-CN-Xiaoxiao', speed: 1.0 }
            },
            LIPSYNC: { 
                id: 'lipsync', label: '口播对齐', icon: 'zap', color: 'bg-yellow-500',
                inputs: ['video', 'audio'], outputs: ['video'],
                config: { precision: 'high' }
            },
            UPSCALE: { 
                id: 'upscale', label: '视频增强', icon: 'wand', color: 'bg-teal-500',
                inputs: ['video'], outputs: ['video'],
                config: { scale: '2x', denoise: true }
            },
            REFERENCE: { 
                id: 'reference', label: '一键拉片', icon: 'eye', color: 'bg-gray-600',
                inputs: [], outputs: ['analysis'],
                config: { url: '', extract_frames: true }
            },
            OUTPUT: { 
                id: 'output', label: '视频导出', icon: 'share', color: 'bg-slate-700',
                inputs: ['video'], outputs: [],
                config: { format: 'mp4', quality: '1080p' }
            }
        };

        // AI服务配置
        const AI_SERVICES = {
            image: [
                { id: 'midjourney', name: 'Midjourney', apiKey: '', baseUrl: 'https://api.midjourney.com', type: 'apikey' },
                { id: 'stability', name: 'Stable Diffusion XL', apiKey: '', baseUrl: 'https://api.stability.ai', type: 'apikey' },
                { id: 'dalle3', name: 'DALL-E 3', apiKey: '', baseUrl: 'https://api.openai.com', type: 'apikey' },
                { id: 'jimeng', name: '即梦 Dreamina', apiKey: '', baseUrl: '', type: 'oauth' }
            ],
            video: [
                { id: 'runway', name: 'Runway Gen-3', apiKey: '', baseUrl: 'https://api.runwayml.com', type: 'apikey' },
                { id: 'pika', name: 'Pika Labs', apiKey: '', baseUrl: '', type: 'oauth' },
                { id: 'kling', name: '可灵 Kling', apiKey: '', baseUrl: '', type: 'apikey' },
                { id: 'luma', name: 'Luma Dream Machine', apiKey: '', baseUrl: '', type: 'apikey' }
            ],
            voice: [
                { id: 'elevenlabs', name: 'ElevenLabs', apiKey: '', baseUrl: 'https://api.elevenlabs.io', type: 'apikey' },
                { id: 'azure', name: 'Azure TTS', apiKey: '', baseUrl: '', type: 'apikey' },
                { id: 'openai', name: 'OpenAI TTS', apiKey: '', baseUrl: '', type: 'apikey' }
            ]
        };

        // 预设工作流模板
        const WORKFLOW_TEMPLATES = [
            {
                id: 'short-drama',
                name: '抖音短剧标准流',
                description: '从剧本到成片的完整短剧工作流',
                nodes: [
                    { type: 'SCRIPT_INPUT', x: 100, y: 100 },
                    { type: 'STORYBOARD', x: 100, y: 250 },
                    { type: 'CHARACTER', x: 300, y: 250 },
                    { type: 'TEXT2IMAGE', x: 100, y: 400 },
                    { type: 'IMAGE2VIDEO', x: 100, y: 550 },
                    { type: 'VOICEOVER', x: 300, y: 400 },
                    { type: 'LIPSYNC', x: 200, y: 700 },
                    { type: 'OUTPUT', x: 200, y: 850 }
                ]
            },
            {
                id: 'cinematic',
                name: '电影级TVC',
                description: '高质量商业广告工作流',
                nodes: [
                    { type: 'REFERENCE', x: 100, y: 100 },
                    { type: 'SCRIPT_INPUT', x: 100, y: 250 },
                    { type: 'STORYBOARD', x: 300, y: 250 },
                    { type: 'TEXT2IMAGE', x: 300, y: 400 },
                    { type: 'VIDEO_PROMPT', x: 300, y: 550 },
                    { type: 'UPSCALE', x: 300, y: 700 },
                    { type: 'OUTPUT', x: 300, y: 850 }
                ]
            }
        ];

        // 主应用组件
        const App = () => {
            const [nodes, setNodes] = useState([]);
            const [connections, setConnections] = useState([]);
            const [selectedNode, setSelectedNode] = useState(null);
            const [scale, setScale] = useState(1);
            const [offset, setOffset] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragNode, setDragNode] = useState(null);
            const [isConnecting, setIsConnecting] = useState(false);
            const [connectFrom, setConnectFrom] = useState(null);
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
            const [showSettings, setShowSettings] = useState(false);
            const [showTemplates, setShowTemplates] = useState(false);
            const [isProcessing, setIsProcessing] = useState(false);
            const [logs, setLogs] = useState([]);
            const [darkMode, setDarkMode] = useState(false);
            const canvasRef = useRef(null);
            
            // 拖拽画布
            const [isPanning, setIsPanning] = useState(false);
            const [panStart, setPanStart] = useState({ x: 0, y: 0 });

            // 初始化音频
            useEffect(() => {
                // 预加载UI音效
                return () => {};
            }, []);

            const playSound = (type) => {
                try {
                    const synth = new Tone.Synth().toDestination();
                    switch(type) {
                        case 'click': synth.triggerAttackRelease("C5", "32n", undefined, 0.1); break;
                        case 'connect': synth.triggerAttackRelease("E5", "16n", undefined, 0.2); break;
                        case 'success': synth.triggerAttackRelease("C6", "8n", undefined, 0.3); break;
                        case 'delete': synth.triggerAttackRelease("G3", "32n", undefined, 0.1); break;
                    }
                } catch(e) {}
            };

            // 从左侧拖拽添加节点
            const handleDragStart = (e, nodeType) => {
                e.dataTransfer.setData('nodeType', nodeType);
                playSound('click');
            };

            const handleDrop = (e) => {
                e.preventDefault();
                const nodeTypeKey = e.dataTransfer.getData('nodeType');
                if (!nodeTypeKey || !NODE_TYPES[nodeTypeKey]) return;
                
                const rect = canvasRef.current.getBoundingClientRect();
                const x = (e.clientX - rect.left - offset.x) / scale;
                const y = (e.clientY - rect.top - offset.y) / scale;
                
                const newNode = {
                    id: Date.now(),
                    type: nodeTypeKey,
                    x, y,
                    data: { ...NODE_TYPES[nodeTypeKey].config },
                    status: 'idle' // idle, processing, done, error
                };
                
                setNodes([...nodes, newNode]);
                playSound('click');
            };

            // 节点拖拽移动
            const handleNodeMouseDown = (e, node) => {
                if (e.target.closest('.port')) return; // 如果点击的是端口，不拖拽
                e.stopPropagation();
                setSelectedNode(node);
                setDragNode(node);
                setIsDragging(true);
            };

            // 画布平移
            const handleCanvasMouseDown = (e) => {
                if (e.target === canvasRef.current || e.target.classList.contains('dot-grid')) {
                    setIsPanning(true);
                    setPanStart({ x: e.clientX - offset.x, y: e.clientY - offset.y });
                    setSelectedNode(null);
                }
            };

            const handleMouseMove = (e) => {
                const rect = canvasRef.current.getBoundingClientRect();
                const x = (e.clientX - rect.left - offset.x) / scale;
                const y = (e.clientY - rect.top - offset.y) / scale;
                setMousePos({ x, y });

                if (isDragging && dragNode) {
                    setNodes(nodes.map(n => 
                        n.id === dragNode.id ? { ...n, x: x - 80, y: y - 20 } : n
                    ));
                } else if (isPanning) {
                    setOffset({ 
                        x: e.clientX - panStart.x, 
                        y: e.clientY - panStart.y 
                    });
                }
            };

            const handleMouseUp = () => {
                setIsDragging(false);
                setDragNode(null);
                setIsPanning(false);
            };

            // 连接端口
            const handlePortClick = (e, nodeId, type, index) => {
                e.stopPropagation();
                if (!isConnecting) {
                    setIsConnecting(true);
                    setConnectFrom({ nodeId, type, index });
                    playSound('click');
                } else {
                    if (connectFrom.nodeId !== nodeId) {
                        // 创建连接
                        const newConn = {
                            id: Date.now(),
                            from: connectFrom,
                            to: { nodeId, type, index }
                        };
                        setConnections([...connections, newConn]);
                        playSound('connect');
                    }
                    setIsConnecting(false);
                    setConnectFrom(null);
                }
            };

            // 删除节点
            const deleteNode = (nodeId) => {
                setNodes(nodes.filter(n => n.id !== nodeId));
                setConnections(connections.filter(c => 
                    c.from.nodeId !== nodeId && c.to.nodeId !== nodeId
                ));
                if (selectedNode?.id === nodeId) setSelectedNode(null);
                playSound('delete');
            };

            // 运行工作流
            const runWorkflow = async () => {
                setIsProcessing(true);
                setLogs([]);
                playSound('success');
                
                // 拓扑排序执行节点
                const executeNode = async (node) => {
                    setNodes(prev => prev.map(n => 
                        n.id === node.id ? { ...n, status: 'processing' } : n
                    ));
                    
                    addLog(`正在处理: ${NODE_TYPES[node.type].label}...`);
                    await new Promise(r => setTimeout(r, 1500)); // 模拟AI生成
                    
                    setNodes(prev => prev.map(n => 
                        n.id === node.id ? { ...n, status: 'done' } : n
                    ));
                    addLog(`✓ ${NODE_TYPES[node.type].label} 完成`);
                };

                // 简单遍历执行（实际应该按依赖顺序）
                for (const node of nodes) {
                    await executeNode(node);
                }
                
                setIsProcessing(false);
                playSound('success');
            };

            const addLog = (msg) => {
                setLogs(prev => [...prev, { time: new Date().toLocaleTimeString(), msg }]);
            };

            // 加载模板
            const loadTemplate = (template) => {
                const newNodes = template.nodes.map((n, i) => ({
                    id: Date.now() + i,
                    type: n.type,
                    x: n.x,
                    y: n.y,
                    data: { ...NODE_TYPES[n.type].config },
                    status: 'idle'
                }));
                setNodes(newNodes);
                setConnections([]);
                setShowTemplates(false);
                playSound('success');
            };

            // 缩放控制
            const handleWheel = (e) => {
                if (e.ctrlKey) {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? 0.9 : 1.1;
                    setScale(Math.min(Math.max(0.5, scale * delta), 2));
                }
            };

            return (
                <div className={`h-screen w-screen flex flex-col overflow-hidden ${darkMode ? 'dark bg-gray-900' : 'bg-[#f5f5f7]'}`}>
                    {/* macOS风格标题栏 */}
                    <div className="glass h-11 flex items-center justify-between px-4 select-none z-50">
                        <div className="flex items-center gap-4">
                            <div className="flex gap-2 mr-4">
                                <div className="traffic-light tl-close cursor-pointer" onClick={() => alert('提示：这是一个单文件HTML应用，直接关闭浏览器标签页即可退出。')}></div>
                                <div className="traffic-light tl-min"></div>
                                <div className="traffic-light tl-max"></div>
                            </div>
                            <span className="font-semibold text-sm text-gray-700 dark:text-gray-200 flex items-center gap-2">
                                <Icon name="film" size={16} />
                                Tapnow Studio
                            </span>
                            <div className="hidden md:flex gap-4 text-xs text-gray-600 dark:text-gray-400 ml-6">
                                <span className="hover:text-gray-900 cursor-pointer">文件</span>
                                <span className="hover:text-gray-900 cursor-pointer">编辑</span>
                                <span className="hover:text-gray-900 cursor-pointer">视图</span>
                                <span className="hover:text-gray-900 cursor-pointer">节点</span>
                                <span className="hover:text-gray-900 cursor-pointer">帮助</span>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            <button 
                                onClick={() => setDarkMode(!darkMode)}
                                className="p-1.5 rounded hover:bg-black/5 dark:hover:bg-white/10 transition"
                            >
                                <Icon name={darkMode ? 'refresh' : 'refresh'} size={14} />
                            </button>
                            <button 
                                onClick={() => setShowSettings(true)}
                                className="flex items-center gap-2 px-3 py-1.5 bg-white/50 dark:bg-white/10 rounded-md text-xs font-medium hover:bg-white/80 transition border border-black/5 dark:border-white/10"
                            >
                                <Icon name="settings" size={14} />
                                API配置
                            </button>
                        </div>
                    </div>

                    {/* 主内容区 */}
                    <div className="flex-1 flex overflow-hidden">
                        {/* 左侧工具栏 */}
                        <div className="w-64 glass border-r border-black/5 dark:border-white/5 flex flex-col">
                            <div className="p-4 border-b border-black/5 dark:border-white/5">
                                <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">节点库</h3>
                                <input 
                                    type="text" 
                                    placeholder="搜索节点..." 
                                    className="w-full px-3 py-1.5 text-xs bg-white/50 dark:bg-black/20 rounded-md border border-black/5 outline-none focus:ring-2 focus:ring-blue-500/20"
                                />
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-6">
                                <div>
                                    <h4 className="text-xs font-medium text-gray-400 mb-2 flex items-center gap-2">
                                        <Icon name="type" size={12} /> 输入
                                    </h4>
                                    <div 
                                        draggable
                                        onDragStart={(e) => handleDragStart(e, 'SCRIPT_INPUT')}
                                        className="node-item flex items-center gap-3 p-3 mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5 hover:shadow-md hover:border-blue-400/50 cursor-move transition group"
                                    >
                                        <div className="w-8 h-8 rounded bg-blue-500 flex items-center justify-center text-white">
                                            <Icon name="type" size={14} />
                                        </div>
                                        <div>
                                            <div className="text-sm font-medium">剧本输入</div>
                                            <div className="text-xs text-gray-400">短剧脚本</div>
                                        </div>
                                    </div>
                                    <div 
                                        draggable
                                        onDragStart={(e) => handleDragStart(e, 'REFERENCE')}
                                        className="node-item flex items-center gap-3 p-3 mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5 hover:shadow-md cursor-move transition"
                                    >
                                        <div className="w-8 h-8 rounded bg-gray-600 flex items-center justify-center text-white">
                                            <Icon name="eye" size={14} />
                                        </div>
                                        <div>
                                            <div className="text-sm font-medium">一键拉片</div>
                                            <div className="text-xs text-gray-400">参考分析</div>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 className="text-xs font-medium text-gray-400 mb-2 flex items-center gap-2">
                                        <Icon name="wand" size={12} /> AI生成
                                    </h4>
                                    {['STORYBOARD', 'CHARACTER', 'TEXT2IMAGE', 'IMAGE2VIDEO', 'VIDEO_PROMPT', 'VOICEOVER'].map(type => (
                                        <div 
                                            key={type}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, type)}
                                            className="node-item flex items-center gap-3 p-3 mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5 hover:shadow-md cursor-move transition"
                                        >
                                            <div className={`w-8 h-8 rounded ${NODE_TYPES[type].color} flex items-center justify-center text-white`}>
                                                <Icon name={NODE_TYPES[type].icon} size={14} />
                                            </div>
                                            <div>
                                                <div className="text-sm font-medium">{NODE_TYPES[type].label}</div>
                                                <div className="text-xs text-gray-400">AI驱动</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div>
                                    <h4 className="text-xs font-medium text-gray-400 mb-2 flex items-center gap-2">
                                        <Icon name="share" size={12} /> 后期与输出
                                    </h4>
                                    {['LIPSYNC', 'UPSCALE', 'OUTPUT'].map(type => (
                                        <div 
                                            key={type}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, type)}
                                            className="node-item flex items-center gap-3 p-3 mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-black/5 hover:shadow-md cursor-move transition"
                                        >
                                            <div className={`w-8 h-8 rounded ${NODE_TYPES[type].color} flex items-center justify-center text-white`}>
                                                <Icon name={NODE_TYPES[type].icon} size={14} />
                                            </div>
                                            <div>
                                                <div className="text-sm font-medium">{NODE_TYPES[type].label}</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="p-4 border-t border-black/5 dark:border-white/5">
                                <button 
                                    onClick={() => setShowTemplates(true)}
                                    className="w-full py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium transition shadow-sm"
                                >
                                    加载预设流
                                </button>
                            </div>
                        </div>

                        {/* 中央画布 */}
                        <div className="flex-1 relative overflow-hidden bg-[#f5f5f7] dark:bg-gray-900">
                            <div 
                                ref={canvasRef}
                                className="absolute inset-0 dot-grid cursor-grab active:cursor-grabbing"
                                style={{
                                    transform: `translate(${offset.x}px, ${offset.y}px) scale(${scale})`,
                                    transformOrigin: '0 0'
                                }}
                                onMouseDown={handleCanvasMouseDown}
                                onMouseMove={handleMouseMove}
                                onMouseUp={handleMouseUp}
                                onMouseLeave={handleMouseUp}
                                onWheel={handleWheel}
                                onDrop={handleDrop}
                                onDragOver={(e) => e.preventDefault()}
                            >
                                {/* 连接线SVG层 */}
                                <svg className="absolute inset-0 pointer-events-none" style={{ width: '100%', height: '100%', overflow: 'visible' }}>
                                    {connections.map(conn => {
                                        const fromNode = nodes.find(n => n.id === conn.from.nodeId);
                                        const toNode = nodes.find(n => n.id === conn.to.nodeId);
                                        if (!fromNode || !toNode) return null;
                                        const x1 = fromNode.x + 160;
                                        const y1 = fromNode.y + 40;
                                        const x2 = toNode.x;
                                        const y2 = toNode.y + 40;
                                        return (
                                            <path 
                                                key={conn.id}
                                                d={`M ${x1} ${y1} C ${x1 + 50} ${y1}, ${x2 - 50} ${y2}, ${x2} ${y2}`}
                                                className="connection-line pointer-events-auto"
                                                strokeDasharray={isProcessing ? "5,5" : "none"}
                                                style={{
                                                    animation: isProcessing ? 'dash 1s linear infinite' : 'none'
                                                }}
                                            />
                                        );
                                    })}
                                    {/* 正在拖拽的连接线 */}
                                    {isConnecting && connectFrom && (
                                        <line
                                            x1={nodes.find(n => n.id === connectFrom.nodeId)?.x + 160}
                                            y1={nodes.find(n => n.id === connectFrom.nodeId)?.y + 40}
                                            x2={mousePos.x}
                                            y2={mousePos.y}
                                            stroke="#3b82f6"
                                            strokeWidth="2"
                                            strokeDasharray="4"
                                        />
                                    )}
                                </svg>

                                {/* 节点 */}
                                {nodes.map(node => (
                                    <div
                                        key={node.id}
                                        className={`absolute w-40 bg-white dark:bg-gray-800 rounded-xl shadow-lg border ${selectedNode?.id === node.id ? 'border-blue-500 ring-2 ring-blue-500/20' : 'border-black/5 dark:border-white/10'} ${node.status === 'processing' ? 'node-processing' : ''} transition-shadow hover:shadow-xl`}
                                        style={{ left: node.x, top: node.y }}
                                        onMouseDown={(e) => handleNodeMouseDown(e, node)}
                                        onClick={() => setSelectedNode(node)}
                                    >
                                        {/* 节点头部 */}
                                        <div className={`h-8 ${NODE_TYPES[node.type].color} rounded-t-xl flex items-center justify-between px-3`}>
                                            <div className="flex items-center gap-2 text-white">
                                                <Icon name={NODE_TYPES[node.type].icon} size={12} />
                                                <span className="text-xs font-medium truncate">{NODE_TYPES[node.type].label}</span>
                                            </div>
                                            <button 
                                                onClick={(e) => { e.stopPropagation(); deleteNode(node.id); }}
                                                className="text-white/70 hover:text-white opacity-0 group-hover:opacity-100 transition"
                                            >
                                                <Icon name="x" size={12} />
                                            </button>
                                        </div>
                                        
                                        {/* 节点端口 */}
                                        <div className="relative p-3">
                                            {/* 输入端口 */}
                                            {NODE_TYPES[node.type].inputs.length > 0 && (
                                                <div className="absolute -left-2 top-1/2 -translate-y-1/2 flex flex-col gap-2">
                                                    {NODE_TYPES[node.type].inputs.map((input, i) => (
                                                        <div 
                                                            key={i}
                                                            className="port w-4 h-4 bg-gray-400 rounded-full border-2 border-white dark:border-gray-800 cursor-pointer hover:bg-blue-500 transition shadow-sm"
                                                            onClick={(e) => handlePortClick(e, node.id, 'input', i)}
                                                            title={input}
                                                        />
                                                    ))}
                                                </div>
                                            )}
                                            
                                            {/* 输出端口 */}
                                            {NODE_TYPES[node.type].outputs.length > 0 && (
                                                <div className="absolute -right-2 top-1/2 -translate-y-1/2 flex flex-col gap-2">
                                                    {NODE_TYPES[node.type].outputs.map((output, i) => (
                                                        <div 
                                                            key={i}
                                                            className="port w-4 h-4 bg-gray-400 rounded-full border-2 border-white dark:border-gray-800 cursor-pointer hover:bg-blue-500 transition shadow-sm"
                                                            onClick={(e) => handlePortClick(e, node.id, 'output', i)}
                                                            title={output}
                                                        />
                                                    ))}
                                                </div>
                                            )}
                                            
                                            {/* 节点内容预览 */}
                                            <div className="space-y-2">
                                                {node.status === 'done' && (
                                                    <div className="aspect-video bg-gray-100 dark:bg-gray-700 rounded flex items-center justify-center text-gray-400">
                                                        <Icon name="image" size={20} />
                                                    </div>
                                                )}
                                                <div className="text-xs text-gray-500 dark:text-gray-400 line-clamp-2">
                                                    {JSON.stringify(node.data).slice(0, 50)}...
                                                </div>
                                                {node.status === 'processing' && (
                                                    <div className="flex items-center gap-2 text-xs text-blue-500">
                                                        <div className="w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"/>
                                                        生成中...
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* 画布控制栏 */}
                            <div className="absolute bottom-6 left-1/2 -translate-x-1/2 glass rounded-full px-4 py-2 flex items-center gap-4 shadow-lg">
                                <button onClick={() => setScale(s => Math.max(0.5, s - 0.1))} className="p-1 hover:bg-black/5 rounded">
                                    <Icon name="minus" size={16} />
                                </button>
                                <span className="text-xs font-mono w-12 text-center">{Math.round(scale * 100)}%</span>
                                <button onClick={() => setScale(s => Math.min(2, s + 0.1))} className="p-1 hover:bg-black/5 rounded">
                                    <Icon name="plus" size={16} />
                                </button>
                                <div className="w-px h-4 bg-black/10 mx-2"/>
                                <button 
                                    onClick={runWorkflow}
                                    disabled={isProcessing || nodes.length === 0}
                                    className={`flex items-center gap-2 px-4 py-1.5 rounded-full text-sm font-medium transition ${isProcessing ? 'bg-gray-400' : 'bg-blue-500 hover:bg-blue-600'} text-white disabled:opacity-50`}
                                >
                                    {isProcessing ? <Icon name="refresh" size={14} /> : <Icon name="play" size={14} />}
                                    {isProcessing ? '运行中' : '运行工作流'}
                                </button>
                            </div>

                            {/* 坐标显示 */}
                            <div className="absolute bottom-6 right-6 text-xs text-gray-400 font-mono">
                                X: {Math.round(mousePos.x)} Y: {Math.round(mousePos.y)}
                            </div>
                        </div>

                        {/* 右侧属性面板 */}
                        <div className="w-80 glass border-l border-black/5 dark:border-white/5 flex flex-col">
                            {selectedNode ? (
                                <>
                                    <div className="p-4 border-b border-black/5 dark:border-white/5">
                                        <h3 className="font-semibold text-sm flex items-center gap-2">
                                            <div className={`w-6 h-6 rounded ${NODE_TYPES[selectedNode.type].color} flex items-center justify-center text-white`}>
                                                <Icon name={NODE_TYPES[selectedNode.type].icon} size={12} />
                                            </div>
                                            {NODE_TYPES[selectedNode.type].label} 配置
                                        </h3>
                                    </div>
                                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                                        {/* 动态配置表单 */}
                                        {Object.entries(selectedNode.data).map(([key, value]) => (
                                            <div key={key} className="space-y-1.5">
                                                <label className="text-xs font-medium text-gray-600 dark:text-gray-400 uppercase">
                                                    {key === 'placeholder' ? '提示文本' : 
                                                     key === 'model' ? 'AI模型' : 
                                                     key === 'size' ? '尺寸比例' :
                                                     key === 'duration' ? '时长(秒)' :
                                                     key === 'quality' ? '质量' :
                                                     key === 'voice' ? '声音角色' :
                                                     key === 'speed' ? '语速' :
                                                     key === 'scenes' ? '分镜数' :
                                                     key === 'style' ? '风格' :
                                                     key === 'consistency' ? '角色一致性' :
                                                     key === 'motion' ? '运动幅度' :
                                                     key === 'format' ? '输出格式' :
                                                     key}
                                                </label>
                                                {typeof value === 'boolean' ? (
                                                    <input 
                                                        type="checkbox" 
                                                        checked={value}
                                                        onChange={(e) => {
                                                            const newNodes = nodes.map(n => 
                                                                n.id === selectedNode.id 
                                                                    ? { ...n, data: { ...n.data, [key]: e.target.checked }} 
                                                                    : n
                                                            );
                                                            setNodes(newNodes);
                                                            setSelectedNode({ ...selectedNode, data: { ...selectedNode.data, [key]: e.target.checked }});
                                                        }}
                                                        className="w-4 h-4 rounded border-gray-300 text-blue-500"
                                                    />
                                                ) : typeof value === 'number' ? (
                                                    <div className="flex items-center gap-2">
                                                        <input 
                                                            type="range" 
                                                            min="1" 
                                                            max="10" 
                                                            value={value}
                                                            onChange={(e) => {
                                                                const val = Number(e.target.value);
                                                                const newNodes = nodes.map(n => 
                                                                    n.id === selectedNode.id 
                                                                        ? { ...n, data: { ...n.data, [key]: val }} 
                                                                        : n
                                                                );
                                                                setNodes(newNodes);
                                                                setSelectedNode({ ...selectedNode, data: { ...selectedNode.data, [key]: val }});
                                                            }}
                                                        />
                                                        <span className="text-xs w-6">{value}</span>
                                                    </div>
                                                ) : value.length > 20 ? (
                                                    <textarea 
                                                        value={value}
                                                        onChange={(e) => {
                                                            const newNodes = nodes.map(n => 
                                                                n.id === selectedNode.id 
                                                                    ? { ...n, data: { ...n.data, [key]: e.target.value }} 
                                                                    : n
                                                            );
                                                            setNodes(newNodes);
                                                            setSelectedNode({ ...selectedNode, data: { ...selectedNode.data, [key]: e.target.value }});
                                                        }}
                                                        className="w-full px-3 py-2 text-sm bg-white dark:bg-black/20 border border-black/10 rounded-lg outline-none focus:border-blue-500 min-h-[80px]"
                                                    />
                                                ) : (
                                                    <input 
                                                        type="text" 
                                                        value={value}
                                                        onChange={(e) => {
                                                            const newNodes = nodes.map(n => 
                                                                n.id === selectedNode.id 
                                                                    ? { ...n, data: { ...n.data, [key]: e.target.value }} 
                                                                    : n
                                                            );
                                                            setNodes(newNodes);
                                                            setSelectedNode({ ...selectedNode, data: { ...selectedNode.data, [key]: e.target.value }});
                                                        }}
                                                        className="w-full px-3 py-2 text-sm bg-white dark:bg-black/20 border border-black/10 rounded-lg outline-none focus:border-blue-500"
                                                    />
                                                )}
                                            </div>
                                        ))}
                                        
                                        <div className="pt-4 border-t border-black/5 dark:border-white/5">
                                            <button 
                                                onClick={() => deleteNode(selectedNode.id)}
                                                className="w-full py-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-sm font-medium transition flex items-center justify-center gap-2"
                                            >
                                                <Icon name="trash" size={14} />
                                                删除节点
                                            </button>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <div className="flex-1 flex flex-col items-center justify-center text-gray-400 p-8 text-center">
                                    <Icon name="layout" size={48} />
                                    <p className="mt-4 text-sm">选择节点以编辑属性</p>
                                    <p className="text-xs mt-2 opacity-60">拖拽左侧节点到画布开始创作</p>
                                </div>
                            )}

                            {/* 日志面板 */}
                            <div className="h-48 border-t border-black/5 dark:border-white/5 bg-gray-50 dark:bg-black/20 p-4 font-mono text-xs overflow-y-auto">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="font-semibold text-gray-600 dark:text-gray-400">控制台</span>
                                    <button onClick={() => setLogs([])} className="text-gray-400 hover:text-gray-600">
                                        <Icon name="x" size={12} />
                                    </button>
                                </div>
                                {logs.length === 0 ? (
                                    <span className="text-gray-400 italic">等待运行...</span>
                                ) : (
                                    logs.map((log, i) => (
                                        <div key={i} className="mb-1">
                                            <span className="text-gray-400 mr-2">[{log.time}]</span>
                                            <span className={log.msg.includes('✓') ? 'text-green-600' : log.msg.includes('错误') ? 'text-red-500' : 'text-gray-700 dark:text-gray-300'}>
                                                {log.msg}
                                            </span>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>

                    {/* API配置模态框 */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/30 backdrop-blur-sm" onClick={() => setShowSettings(false)}>
                            <div className="glass w-[600px] max-h-[80vh] rounded-2xl shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                                <div className="h-12 border-b border-black/5 dark:border-white/5 flex items-center justify-between px-6">
                                    <h3 className="font-semibold">AI 服务配置</h3>
                                    <button onClick={() => setShowSettings(false)} className="text-gray-400 hover:text-gray-600">
                                        <Icon name="x" size={18} />
                                    </button>
                                </div>
                                <div className="p-6 overflow-y-auto max-h-[60vh] space-y-6">
                                    <div className="space-y-4">
                                        <h4 className="text-sm font-semibold text-gray-600 flex items-center gap-2">
                                            <Icon name="image" size={14} /> 图像生成服务
                                        </h4>
                                        {AI_SERVICES.image.map(service => (
                                            <div key={service.id} className="flex items-center gap-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-black/5">
                                                <div className="flex-1">
                                                    <div className="font-medium text-sm">{service.name}</div>
                                                    <div className="text-xs text-gray-400">{service.type === 'oauth' ? 'OAuth登录' : 'API Key'}</div>
                                                </div>
                                                {service.type === 'apikey' ? (
                                                    <input 
                                                        type="password" 
                                                        placeholder="输入 API Key..." 
                                                        className="flex-1 px-3 py-1.5 text-xs bg-gray-50 dark:bg-gray-900 rounded border outline-none focus:border-blue-500"
                                                    />
                                                ) : (
                                                    <button className="px-4 py-1.5 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition">
                                                        连接账号
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    <div className="space-y-4">
                                        <h4 className="text-sm font-semibold text-gray-600 flex items-center gap-2">
                                            <Icon name="video" size={14} /> 视频生成服务
                                        </h4>
                                        {AI_SERVICES.video.map(service => (
                                            <div key={service.id} className="flex items-center gap-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-black/5">
                                                <div className="flex-1">
                                                    <div className="font-medium text-sm">{service.name}</div>
                                                </div>
                                                <input 
                                                    type="password" 
                                                    placeholder={service.type === 'oauth' ? "点击授权" : "输入 API Key..."} 
                                                    className="flex-1 px-3 py-1.5 text-xs bg-gray-50 dark:bg-gray-900 rounded border outline-none focus:border-blue-500"
                                                />
                                            </div>
                                        ))}
                                    </div>

                                    <div className="space-y-4">
                                        <h4 className="text-sm font-semibold text-gray-600 flex items-center gap-2">
                                            <Icon name="mic" size={14} /> 语音合成服务
                                        </h4>
                                        {AI_SERVICES.voice.map(service => (
                                            <div key={service.id} className="flex items-center gap-4 p-3 bg-white dark:bg-gray-800 rounded-lg border border-black/5">
                                                <div className="flex-1">
                                                    <div className="font-medium text-sm">{service.name}</div>
                                                </div>
                                                <input 
                                                    type="password" 
                                                    placeholder="输入 API Key..." 
                                                    className="flex-1 px-3 py-1.5 text-xs bg-gray-50 dark:bg-gray-900 rounded border outline-none focus:border-blue-500"
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="h-16 border-t border-black/5 dark:border-white/5 flex items-center justify-end px-6 gap-3 bg-gray-50 dark:bg-gray-900/50">
                                    <button onClick={() => setShowSettings(false)} className="px-4 py-2 text-sm text-gray-600 hover:text-gray-900 transition">
                                        取消
                                    </button>
                                    <button 
                                        onClick={() => {
                                            playSound('success');
                                            setShowSettings(false);
                                            addLog('✓ API配置已保存（模拟）');
                                        }}
                                        className="px-4 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
                                    >
                                        保存配置
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* 模板选择模态框 */}
                    {showTemplates && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/30 backdrop-blur-sm" onClick={() => setShowTemplates(false)}>
                            <div className="glass w-[700px] h-[500px] rounded-2xl shadow-2xl overflow-hidden" onClick={e => e.stopPropagation()}>
                                <div className="h-12 border-b border-black/5 dark:border-white/5 flex items-center justify-between px-6">
                                    <h3 className="font-semibold">预设工作流</h3>
                                    <button onClick={() => setShowTemplates(false)} className="text-gray-400 hover:text-gray-600">
                                        <Icon name="x" size={18} />
                                    </button>
                                </div>
                                <div className="p-6 grid grid-cols-2 gap-4">
                                    {WORKFLOW_TEMPLATES.map(template => (
                                        <div 
                                            key={template.id}
                                            onClick={() => loadTemplate(template)}
                                            className="p-6 bg-white dark:bg-gray-800 rounded-xl border border-black/5 hover:border-blue-500/50 hover:shadow-lg cursor-pointer transition group"
                                        >
                                            <div className="flex items-center justify-between mb-3">
                                                <h4 className="font-semibold text-lg">{template.name}</h4>
                                                <Icon name="check" size={18} className="text-blue-500 opacity-0 group-hover:opacity-100 transition" />
                                            </div>
                                            <p className="text-sm text-gray-500 mb-4">{template.description}</p>
                                            <div className="flex flex-wrap gap-2">
                                                {template.nodes.slice(0, 4).map((n, i) => (
                                                    <span key={i} className="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded-md text-gray-600 dark:text-gray-300">
                                                        {NODE_TYPES[n.type].label}
                                                    </span>
                                                ))}
                                                {template.nodes.length > 4 && (
                                                    <span className="px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded-md text-gray-400">
                                                        +{template.nodes.length - 4}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    <div className="p-6 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl flex flex-col items-center justify-center text-gray-400 hover:border-blue-400 hover:text-blue-500 cursor-pointer transition">
                                        <Icon name="plus" size={32} />
                                        <span className="mt-2 text-sm">创建空白工作流</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <style>
        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</body>
</html>
